<!DOCTYPE html>
<html>
    <head>
      <link href='http://fonts.googleapis.com/css?family=EB+Garamond' rel='stylesheet' type='text/css'>

      <script src="//code.jquery.com/jquery-1.10.2.js"></script>
      <link href='http://fonts.googleapis.com/css?family=Carme' rel='stylesheet' type='text/css'>


        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Rubyks, a gem</title>
        <meta name="viewport" content="width=device-width">


        <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="/favicon.ico" type="image/x-icon" />

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntaxsol.css">

    </head>
    <body>

        <div class='sitebackground'></div>
        <div class="sidebar">
          <a href="/about.html"> <img class="blur about" src="http://www.gravatar.com/avatar/78359dd9d3cf59abacfa85565edc1eb2?s=150" /></a>
          <a href="/"> <img class="blur index" src="/images/compex.svg"/></a>
          <div class='categories'></div>
          <a href="/music.html"> <img class="blur music" src="/images/guitar.svg"/></a>
          <a href="/photo.html"> <img class="blur photo" src="/images/cam.svg"/></a>

       <BR>&nbsp;<BR>
          <!-- this won't work on github pages but keeping it in for when I migrate to linode: -->
          <!-- {  % render_archives site  %  } -->

       <BR>&nbsp;<BR>
       <BR>&nbsp;<BR>
       <BR>&nbsp;<BR>
        </div>

        <div class="site">
          <div class="header">
          </div>

                 <BR>&nbsp;<BR>
<h2 class="post-title" >Rubyks, a gem</h2>
<hr>
<span class="post-date">November 12, 2013</span>

<div class="post">
<p>After writing the initial iteration of the The Chorder, I started thinking about other systems that I might be able to model, and the rubiks cube seemed perfect. It is visual, easy to conceptualize, and completely contained- any possible combination can be arrived at by starting at the solved cube (the &quot;base case&quot;) and shuffling. All I had to do was model the state of the cube in some sort of data structure and implement the various transformations accurately and the program would be accurate. Easy, right?!</p>

<!--break-->

<p>And actually, it was pretty easy... not at first, necessarily- there was a fair amount of head scratching about how, exactly, I was going to store the state of the cube at any one time (I&#39;m not convinced I picked the best method, either... but more on that later...)</p>

<p>I eventually settled on a two dimensional array containing 6 other arrays (one for each face of the whole cube) of 9 elements each (one for each square on each face.) More about the structure from the README:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">@cube[0] - top
@cube[1] - left
@cube[2] - back
@cube[3] - right
@cube[4] - front
@cube[5] - bottom
</code></pre></div>
<p>The first element @cube[x][0] in any array describes the center square of that face, and remains static in relation to the other sides, just as a real cube&#39;s center square would. </p>

<p>The remaining array elements from [1] - [8] start at &quot;12 o&#39;clock&quot; and move clockwise. Thus: Even numbers are middle cubies and odd numbers are always corner cubies.</p>

<p>&quot;12 o&#39;clock&quot; is constant amongst all sides of the cube, and refers to what &quot;north&quot; would be if the cube was unfolded into two dimensions like so:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">    1
5,4,0,2
    3
</code></pre></div>
<p>When cube orientation procedures are applied, the &quot;address&quot; of each side remains consistent with the above diagram, even as the sides themselves represent different numbers. (The sides could just as easily be assigned any symbol or string or whatnott, just as long as each side started off all the same thing, the cube would be in a legal state).</p>

<p>If you created a new cube and then applied Cube#turn, the sides would appear like so:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">    4
5,3,0,1
    2
</code></pre></div>
<p>But the address of the location of these sides would remain static. This is so that complex move combinations can be applied to a cube regardless of its orientation to the &quot;viewer.&quot;</p>

<p>This does have the advantage of offering a static &quot;address&quot; for each mini square on each face of the cube, but doesn&#39;t offer any scalability- I can&#39;t instantiate a cube of an arbitrary size (like Cube.new(n), for example) because the relationships between the different faces is defined in the methods that act upon them, and not in the data structure itself.</p>

<p>After the data structure was designed, implementing the transformations was fairly straightforward. there are only 6 basic moves- each face can be turned clockwise once (turning a face counterclockwise is the same as turning it clockwise three times). here is the method for turning the top face clockwise once:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">u</span>
    <span class="n">cubetemp</span> <span class="o">=</span> <span class="no">Marshal</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="no">Marshal</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="vi">@cube</span><span class="p">))</span>

    <span class="n">cubetemp</span><span class="o">[</span><span class="mi">1</span><span class="o">][</span><span class="mi">4</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@cube</span><span class="o">[</span><span class="mi">4</span><span class="o">][</span><span class="mi">2</span><span class="o">]</span>
    <span class="n">cubetemp</span><span class="o">[</span><span class="mi">1</span><span class="o">][</span><span class="mi">5</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@cube</span><span class="o">[</span><span class="mi">4</span><span class="o">][</span><span class="mi">3</span><span class="o">]</span>
    <span class="n">cubetemp</span><span class="o">[</span><span class="mi">1</span><span class="o">][</span><span class="mi">6</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@cube</span><span class="o">[</span><span class="mi">4</span><span class="o">][</span><span class="mi">4</span><span class="o">]</span>

    <span class="n">cubetemp</span><span class="o">[</span><span class="mi">4</span><span class="o">][</span><span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@cube</span><span class="o">[</span><span class="mi">3</span><span class="o">][</span><span class="mi">8</span><span class="o">]</span>
    <span class="n">cubetemp</span><span class="o">[</span><span class="mi">4</span><span class="o">][</span><span class="mi">3</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@cube</span><span class="o">[</span><span class="mi">3</span><span class="o">][</span><span class="mi">1</span><span class="o">]</span>
    <span class="n">cubetemp</span><span class="o">[</span><span class="mi">4</span><span class="o">][</span><span class="mi">4</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@cube</span><span class="o">[</span><span class="mi">3</span><span class="o">][</span><span class="mi">2</span><span class="o">]</span>

    <span class="n">cubetemp</span><span class="o">[</span><span class="mi">3</span><span class="o">][</span><span class="mi">8</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@cube</span><span class="o">[</span><span class="mi">2</span><span class="o">][</span><span class="mi">6</span><span class="o">]</span>
    <span class="n">cubetemp</span><span class="o">[</span><span class="mi">3</span><span class="o">][</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@cube</span><span class="o">[</span><span class="mi">2</span><span class="o">][</span><span class="mi">7</span><span class="o">]</span>
    <span class="n">cubetemp</span><span class="o">[</span><span class="mi">3</span><span class="o">][</span><span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@cube</span><span class="o">[</span><span class="mi">2</span><span class="o">][</span><span class="mi">8</span><span class="o">]</span>

    <span class="n">cubetemp</span><span class="o">[</span><span class="mi">2</span><span class="o">][</span><span class="mi">6</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@cube</span><span class="o">[</span><span class="mi">1</span><span class="o">][</span><span class="mi">4</span><span class="o">]</span>
    <span class="n">cubetemp</span><span class="o">[</span><span class="mi">2</span><span class="o">][</span><span class="mi">7</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@cube</span><span class="o">[</span><span class="mi">1</span><span class="o">][</span><span class="mi">5</span><span class="o">]</span>
    <span class="n">cubetemp</span><span class="o">[</span><span class="mi">2</span><span class="o">][</span><span class="mi">8</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@cube</span><span class="o">[</span><span class="mi">1</span><span class="o">][</span><span class="mi">6</span><span class="o">]</span>

    <span class="n">cubetemp</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@cube</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">7</span><span class="o">]</span>
    <span class="n">cubetemp</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@cube</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">8</span><span class="o">]</span>
    <span class="n">cubetemp</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">3</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@cube</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">1</span><span class="o">]</span>
    <span class="n">cubetemp</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">4</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@cube</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">2</span><span class="o">]</span>
    <span class="n">cubetemp</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">5</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@cube</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">3</span><span class="o">]</span>
    <span class="n">cubetemp</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">6</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@cube</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">4</span><span class="o">]</span>
    <span class="n">cubetemp</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">7</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@cube</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">5</span><span class="o">]</span>
    <span class="n">cubetemp</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">8</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@cube</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">6</span><span class="o">]</span>

    <span class="vi">@hist</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="s1">&#39;u&#39;</span>
    <span class="vi">@cube</span> <span class="o">=</span> <span class="no">Marshal</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="no">Marshal</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cubetemp</span><span class="p">))</span>
    <span class="nb">self</span>  
  <span class="k">end</span>
</code></pre></div>
<p>Simple- just reassigning all the colors based on how the cube is moving. Notice that, because I didn&#39;t understand deep copying of data, I used the (then magical) &quot;Marshal&quot; incantation to create a duplicate temporary array to operate on before I redumped the transformed state back into the main attribute. If I didn&#39;t do that, the color assignment would happen sequentially on the main data structure and it wouldn&#39;t be able to properly assign the new values.</p>

<p>Marshal, by the way, is Ruby&#39;s serialization module... it takes any type of data and turns it into a simple byte stream. This was totally overkill. I should have just made a brand new deep copied array by using Array#dup, which does the same thing in a simpler, more secure way. Maybe I&#39;ll update that.</p>

<p>You can see the entire source at the <a href="https://github.com/urthbound/rubyks" target="_blank">Github repo</a>. I also wrote a little interface to interact with the model.</p>

<p>I packaged all this up as a Gem and made it available at <a href="https://rubygems.org/gems/rubyks" target="_blank">rubygems.org</a> for anyone who wants to make use of my data structure and transformation methods to write their own solver.</p>




<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'urthbound'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div>


          <div class="footer">
          <a href="/allposts.html"><p>See all posts</p></a>
          <a href="mailto:jeffowler@gmail.com?Subject=Hello" target='_blank'><img src='/images/email.png' width='30'></a>
          <a href="https://twitter.com/jeffowler" target='_blank'><img src='/images/twitter.png' width='30'></a>
       <BR>&nbsp;<BR>
       <BR>&nbsp;<BR>
       <BR>&nbsp;<BR>
          </div>

      <script>

        if (window.location.pathname=='/')
          var thing = 'index';
        else
          var thing = window.location.pathname.match(/(\w+).html/)[1];

        $('.' + thing).removeClass('blur')
        function unblur() {
          $(this).removeClass('blur');
        };
        function blur() {
          $(this).addClass('blur');
        };
        $( "img.blur" ).hover(unblur, blur);

        $('.list > li a').click(function() {
              $(this).parent().find('ul').toggle();
            });

        jQuery("pre code").html(function(index, html) {
            return html.replace(/^(.*)$/mg, "<span class=\"line\">$1</span>")
        });

      </script>
    </body>
</html>
